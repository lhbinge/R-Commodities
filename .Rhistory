g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))
g
coms <- aggregate(comdata$wheat, by=list(comdata$date), FUN = function(x) sum(!is.na(x)))
for(i in colnames(comdata)[7:29]) {
coms1 <- aggregate(comdata[,i], by=list(comdata$date), FUN = function(x) sum(!is.na(x)))
coms <- merge(coms, coms1, by="Group.1",all.x=TRUE)
}
colnames(coms) <- c("Date",colnames(comdata)[6:29])
complot <- aggregate(comdata$town, by=list(comdata$date, comdata$wheat), FUN = function(x) sum(!is.na(x)))
com.plot <- function(commodity="wheat") {
complot <- aggregate(comdata[,commodity], by=list(comdata$date, comdata$town), FUN = function(x) sum(!is.na(x)))
g <- ggplot(complot, aes(x=Group.1, y=x,fill=Group.2))
g <- g + geom_bar(stat="identity")
g <- g + theme(legend.title=element_blank())
g <- g + theme(legend.key.size = unit(0.4,"cm"))
g <- g + ylab(commodity)
g <- g + xlab("Date")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))
g
}
com.plot("wheat")
com.plot("mealies")
com.plot("eggs")
com.plot("s.horses")
#"wheat","wheat.flour","boer.meal","mealies","mealie.meal","barley","oats","oathay",
#"lucerne.hay","potatoes","tobacco","beef","mutton","butter","eggs","cattle","sheep",
#"pigs","bread","oranges","s.horses","tr.oxen","m.cows","w.sheep"
complot <- aggregate(comdata$wheat, by=list(comdata$datum, comdata$town), FUN = mean)
toets <- melt(complot, id="Group.1")
colnames(complot) <- c("Date","Town","Wheat")
toets <- acast(complot, Date ~ Town, mean, value.var = "Wheat")
toets1 <- toets[21:33,wc.towns]
#====================##
## REPEAT SALES INDEX ##
##====================##
rscomdata <- comdata[,c("time_id","date","town","wheat")]
View(rscomdata)
rscomdata$commodity <- "wheat"
colnames(rscomdata) <- c("counter","date","town","price","commodity")
for(i in colnames(comdata)[7:29]) {
rscomdata1 <- comdata[,c("time_id","date","town",i)]
rscomdata1$commodity <- i
colnames(rscomdata1) <- c("counter","date","town","price","commodity")
rscomdata <- rbind(rscomdata, rscomdata1)
}
rscomdata$lnprice <- log(rscomdata$price)
rscomdata <- transform(rscomdata, id = as.numeric(interaction(factor(town),factor(commodity),drop=TRUE)))
wc.towns <- c("Beaufort West","Cape Town","Clanwilliam","Malmesbury","Mossel Bay","Worcester")
ec.towns <- c("Aliwal North","Burghersdorp","Cradock","Dordrecht","East London","Graaff-Reinet","Graham's Town",
"King William's Town","Port Alfred","Port Elizabeth","Queen's Town","Tarkastad")
kzn.towns <- c("Pietermaritzburg, Natal","Durban, Natal")
#in.towns <- c("Bloemfontein","Bulawayo","Colesberg","Kimberley","Pretoria","Salisbury","Vryburg")
in.towns <- c("Bloemfontein","Bulawayo","Colesberg","Johannesburg","Kimberley","Pretoria","Salisbury","Vryburg")
cape <- c(wc.towns,ec.towns)
col.towns <- c(cape,kzn.towns)
all.towns <- c(wc.towns,ec.towns,kzn.towns,in.towns)
rscomdata1 <- rscomdata[rscomdata$commodity=="wheat",]
#"wheat","mealies","eggs","tobacco","butter","beef"
rscomdata1 <- rscomdata1[rscomdata1$town %in% cape,]
rscomdata1$price.int <- na.approx(rscomdata1$price,rule=2)
View(rscomdata1)
repdata <- repsaledata(rscomdata1$lnprice,rscomdata1$counter,rscomdata1$id)  #transform the data to sales pairs
View(repdata)
toy1 <- melt(toy, id="row.names")
View(toy1)
toy1 <- melt(toy, id="col.names")
toy <- matrix(c(NA, 90,NA,100,
100,90,110,100,
NA,	92,116,103.8,
NA,	93,NA,104.1,
NA,	NA,117,105.5,
110,99,121,110,
110,NA,NA,110),nrow=7,ncol=4)
rm(toy1)
toy1 <- melt(toy, id="col.names")
rep <- repsaledata(toy1$value,toy1$V1,toy1$V2)  #transform the data to sales pairs
rep <- repsaledata(toy1$value,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
View(rep)
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst=1,graph=TRUE)   #generate the repeat sales index
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst=1,graph=FALSE)   #generate the repeat sales index
toy1$lnvalue <- ln(toy1$value)
toy1$lnvalue <- log(toy1$value)
rep <- repsaledata(toy1$lnvalue,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst=1,graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
View(rs_index)
toy1 <- melt(toy[,-4], id="col.names")
toy1$lnvalue <- log(toy1$value)
rep <- repsaledata(toy1$lnvalue,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst=1,graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
toy <- rbind(c(NA, 90,NA,100),
c(100,90,110,100),
c(NA,92,116,103.8),
c(NA,93,NA,104.1),
c(NA,NA,117,105.5),
c(110,99,121,110),
c(110,NA,NA,110))
toy1 <- melt(toy[,-4], id="col.names")
toy1$lnvalue <- log(toy1$value)
rep <- repsaledata(toy1$lnvalue,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst=1,graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
rep <- repsaledata(toy1$value,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst=1,graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
rs_index <- as.data.frame(rsales$pindex)*100
rs_index <- exp(as.data.frame(rsales$pindex))*100
rs_index <- exp(as.data.frame(rsales$pindex))*100
?repsaledata
rep <- repsaledata(toy1$lnvalue,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
?repsale
rs_index <- exp(as.data.frame(rsales$pindex))*100
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
check <- rsales$xmat
View(check)
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst = 0, graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
check <- rsales$xmat
check2 <- rsales$pindex
check2 <- as.data.frame(rsales$pindex)
View(check2)
check2 <- as.data.frame(rsales$dy)
toy1 <- melt(toy[,-4], id="col.names")
rep2 <- repsaledata(toy$lnvalue,toy$Var1,toy$Var2)
rep2 <- repsaledata(toy)
rep <- repsaledata(toy1$value,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst = 0, graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
rep <- repsaledata(toy1$lnvalue,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
rep2 <- repsaledata(toy)
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst = 0, graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst = 1, graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst = 1, graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
rep <- repsaledata(toy1$lnvalue,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
toy1 <- melt(toy[,-4], id="col.names")
toy1$lnvalue <- log(toy1$value)
rep <- repsaledata(toy1$lnvalue,toy1$Var1,toy1$Var2)  #transform the data to sales pairs
rsales <- repsale(rep$price0,rep$time0,rep$price1,rep$time1,mergefirst = 1, graph=FALSE)   #generate the repeat sales index
rs_index <- exp(as.data.frame(rsales$pindex))*100
check <- rsales$xmat
check2 <- as.data.frame(rsales$dy)
repsale
i<-2
toy1[i,toy1$Var2=="1"]
toy1[toy1$Var2=="1",]
toy1$lnvalue[toy1$Var2=="1",]
toy1$lnvalue[toy1$Var2=="1"]
toy2 <- toy1
toy2 <- toy
View(toy2)
!is.na(toy$V1)
toy <- as.data.frame(toy)
!is.na(toy$V1)
toy2$T1 <- 1:7
toy2 <- toy
toy2$T1 <- 1:7
toy2$T2 <- 1:7
toy2$T3 <- 1:7
toy2 <- !is.na(toy)
toy$T1 <- 1:7
toy$T2 <- 1:7
toy$T3 <- 1:7
toy2 <- toy
toy2$V1 <- toy2[!is.na(toy2),"V1"]
toy2 <- toy2[!is.na(toy$V1),c("V1","T1")]
toy2$P1 <- for(i in 1:nrow(toy2) {toy2$V1[i+1]/toy2$V1[i]}
toy2$P1 <- for(i in 1:nrow(toy2)) {toy2$V1[i+1]/toy2$V1[i]}
for(i in 1:nrow(toy2)) {toy2$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i]}
for(i in 1:nrow(toy2)) {toy3$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i]}
toy3 <- data.frame()
for(i in 1:nrow(toy2)) {toy3$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i]}
for(i in 1:nrow(toy2)) {
toy2$P1[i] <- 1
toy2$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i]
}
?diff
toy2$P1 <- diff(toy2$V1)
?ifelse
for(i in 1:nrow(toy2)) {
ifelse(i==1, toy2$P1[i] <- 1, toy2$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i])
}
nrow(toy2)
for(i in 1:nrow(toy2)) {
ifelse(i==1, toy2$P1[i] <- 1, toy2$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i])
}
for(i in 1:(nrow(toy2)-1)) {
ifelse(i==1, toy2$P1[i] <- 1, toy2$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i])
}
for(i in 1:(nrow(toy2)-1)) {
toy2$P1[i] <- 1
toy2$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i]
}
for(i in 1:(nrow(toy2)-1)) {
toy2$P1[1] <- 1
toy2$P1[i+1] <- toy2$V1[i+1]/toy2$V1[i]
}
log(1)
for(i in 1:(nrow(toy2)-1)) {
toy2$P1[1] <- 0
toy2$P1[i+1] <- log(toy2$V1[i+1]/toy2$V1[i])
}
xmat <- array(0, dim = c(nrow(toy2), nrow(toy2)))
View(xmat)
xmat <- array(0, dim = c(nrow(toy2), nrow(toy)))
i <-1
xmat[i,toy2$T1]
toy2$T1
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
toy2$T1[-1]
toy2$T1[i]
xmat[i,toy2$T1[i]]
xmat[i,toy2$T1[i]] <- -1
xmat[i,toy2$T1[i+1]] <- 1
nrow(toy2)-1
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$T1[i]] <- -1
xmat[i,toy2$T1[i+1]] <- 1
}
einde <- cbind(toy2$P1[-1],xmat)
View(einde)
toy2 <- toy
toy2 <- toy2[!is.na(toy$V2),c("V2","T2")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2$V2[i+1]/toy2$V2[i])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
toy$t <- 1:7
toy2 <- toy
toy2 <- toy2[!is.na(toy$V2),c("V2","t")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2$V2[i+1]/toy2$V2[i])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$t[i]] <- -1
xmat[i,toy2$t[i+1]] <- 1
}
einde <- cbind(toy2$P[-1],xmat)
n <- V3
n <- "V3"
toy2 <- toy
toy2 <- toy2[!is.na(toy$n),c(n,"t")]
naam <- "V3"
toy2[!is.na(toy$naam),c("V2","t")]
toy2[!is.na(toy[,naam]),c("V2","t")]
toy2 <- toy
toy <- rbind(c(NA, 90,NA,100),
c(100,90,110,100),
c(NA,92,116,103.8),
c(NA,93,NA,104.1),
c(NA,NA,117,105.5),
c(110,99,121,110),
c(110,NA,NA,110))
toy <- as.data.frame(toy)
toy$t <- 1:7
toy2 <- toy
toy2[!is.na(toy[,naam]),c("V2","t")]
toy2 <- toy2[!is.na(toy[,naam]),c(naam,"t")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2[i+1,naam]/toy2[i,naam])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$t[i]] <- -1
xmat[i,toy2$t[i+1]] <- 1
}
einde <- cbind(toy2$P[-1],xmat)
maak <- function(naam) {
toy2 <- toy
toy2 <- toy2[!is.na(toy[,naam]),c(naam,"t")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2[i+1,naam]/toy2[i,naam])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$t[i]] <- -1
xmat[i,toy2$t[i+1]] <- 1
}
einde <- cbind(toy2$P[-1],xmat)
return(einde)
}
cbind(maak("V1"),maak("V2"),maak("V3"))
rbind(maak("V1"),maak("V2"),maak("V3"))
einde <- rbind(maak("V1"),maak("V2"),maak("V3"))
dy <- einde$V1
xmat <- einde[,2:8]
einde <- as.data.frame(rbind(maak("V1"),maak("V2"),maak("V3")))
dy <- einde$V1
xmat <- einde[,2:8]
ps.RS <- lm(dy ~ xmat + 0)
View(xmat)
View(xmat)
str(xmat)
xmat <- as.matrix(einde[,2:8])
ps.RS <- lm(dy ~ xmat + 0)
ps.RS
summary(ps.RS)
ps.RS$coefficients
rs_index2 <- exp(as.data.frame(ps.RS$coefficients))*100
View(rs_index2)
repsale()
repsale
rs_index <- ps.RS$coefficients
rs_index1 <- ps.RS$coefficients
rs_index1 <- exp(ps.RS$coefficients)
rs_index1 <- as.data.frame(exp(ps.RS$coefficients))
View(rs_index1)
rs_index1[1]
rs_index1[1,1]
rs_index1[1,1]*100
rs_index1 <- as.data.frame(exp(ps.RS$coefficients))/rs_index1[1,1]*100
?alias
alias(ps.RS)
cor(xmat)
rs_index[is.na(rs_index)]
na.approx(rs_index)
na.approx(rs_index1)
?na.approx
is.na(rs_index[i])
rs_index[is.na(rs_index[i])]
?fill
?na.locf
na.locf(rs_index1)
einde <- as.data.frame(rbind(maak("V1"),maak("V2"),maak("V3")))
dy <- einde$V1
xmat <- as.matrix(einde[,2:8])
rsales <- lm(dy ~ xmat + 0)
rs_index <- as.data.frame(exp(rsales$coefficients))/rs_index[1,1]*100
rs_index <- na.locf(rs_index)
rs_index[1
]
rs_index <- as.data.frame(exp(rsales$coefficients))/rs_index[1]*100
rs_index <- na.locf(rs_index)
View(rs_index)
rsales <- lm(dy ~ xmat + 0)
rs_index <- as.data.frame(exp(rsales$coefficients))/rs_index[1]*100
rs_index <- as.data.frame(exp(rsales$coefficients))
rs_index <- rs_index/rs_index[1]*100
n <- rs_index[1]
View(n)
n <- rs_index[1,1]
rs_index <- as.data.frame(exp(rsales$coefficients))
n <- rs_index[1,1]
rs_index <- rs_index/n*100
rs_index <- na.locf(rs_index)
comdata <- read.csv("Commodities.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
#comdata$date <- as.Date(comdata$date, "%Y/%m/%d")
comdata$datum <- paste(comdata$datum, comdata$Year)
comdata$date <- as.Date(as.yearmon(as.character(comdata$datum),"%B %Y"))
comdata$datum <- factor(as.yearmon(as.character(comdata$datum),"%B %Y"))
View(comdata)
toy <- dcast(comdata, time_id + date ~ town, value.var="wheat")
?dcast
?fun.aggregate
toy <- dcast(comdata, time_id + date ~ town, mean, value.var="wheat")
colnames(toy)
toy <- toy[,c("time_id","date","Beaufort West","Cape Town","Worcester)]
)
]
toy$time_id[21:32]
toy <- toy[21:32,c("time_id","date","Beaufort West","Cape Town","Worcester")]
maak <- function(naam) {
toy2 <- toy
toy2 <- toy2[!is.na(toy[,naam]),c(naam,"time_id")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2[i+1,naam]/toy2[i,naam])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$time_id[i]] <- -1
xmat[i,toy2$time_id[i+1]] <- 1
}
einde <- cbind(toy2$P[-1],xmat)
return(einde)
}
einde <- as.data.frame(rbind(maak("Beaufort West"),maak("Cape Town"),maak("Worcester")))
naam <- "Beaufort West"
toy2 <- toy
toy2 <- toy2[!is.na(toy[,naam]),c(naam,"time_id")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2[i+1,naam]/toy2[i,naam])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$time_id[i]] <- -1
xmat[i,toy2$time_id[i+1]] <- 1
}
toy2$time_id[i]
toy$t <- 1:nrow(toy)
maak <- function(naam) {
toy2 <- toy
toy2 <- toy2[!is.na(toy[,naam]),c(naam,"t")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2[i+1,naam]/toy2[i,naam])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$t[i]] <- -1
xmat[i,toy2$t[i+1]] <- 1
}
einde <- cbind(toy2$P[-1],xmat)
return(einde)
}
einde <- as.data.frame(rbind(maak("Beaufort West"),maak("Cape Town"),maak("Worcester")))
dy <- einde$V1
xmat <- as.matrix(einde[,2:8])
rsales <- lm(dy ~ xmat + 0)
rs_index <- as.data.frame(exp(rsales$coefficients))
n <- rs_index[1,1]
rs_index <- rs_index/n*100
rs_index <- na.locf(rs_index)
summary(rsales)
xmat <- as.matrix(einde[,2:ncol(einde)])
rsales <- lm(dy ~ xmat + 0)
rs_index <- as.data.frame(exp(rsales$coefficients))
n <- rs_index[1,1]
rs_index <- rs_index/n*100
rs_index <- na.locf(rs_index)
dy
summary(rsales)
einde <- cbind(einde,index=rs_index)
toy <- cbind(toy,index=rs_index)
toy <- dcast(comdata, time_id + date ~ town, mean, value.var="wheat")
toy <- toy[21:32,c("time_id","date","Beaufort West","Cape Town","Worcester")]
toy$t <- 1:nrow(toy)
toy <- cbind(toy,index==rs_index)
toy <- cbind(toy,rs_index)
toy <- dcast(comdata, time_id + date ~ town, mean, value.var="wheat")
toy <- toy[21:32,c("time_id","date","Beaufort West","Cape Town","Worcester")]
toy$t <- 1:nrow(toy)
toy <- cbind(toy,rs_index)
toy <- dcast(comdata, time_id + date ~ town, mean, value.var="wheat")
toy <- toy[21:30,c("time_id","date","Beaufort West","Cape Town","Worcester")]
toy$t <- 1:nrow(toy)
#toy1$lnvalue <- log(toy1$value)
maak <- function(naam) {
toy2 <- toy
toy2 <- toy2[!is.na(toy[,naam]),c(naam,"t")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2[i+1,naam]/toy2[i,naam])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$t[i]] <- -1
xmat[i,toy2$t[i+1]] <- 1
}
einde <- cbind(toy2$P[-1],xmat)
return(einde)
}
einde <- as.data.frame(rbind(maak("Beaufort West"),maak("Cape Town"),maak("Worcester")))
dy <- einde$V1
xmat <- as.matrix(einde[,2:ncol(einde)])
rsales <- lm(dy ~ xmat + 0)
rs_index <- as.data.frame(exp(rsales$coefficients))
n <- rs_index[1,1]
rs_index <- rs_index/n*100
rs_index <- na.locf(rs_index)
#rs_index2 <- exp(as.data.frame(ps.RS$coefficients))*100
toy <- cbind(toy,rs_index)
toy <- dcast(comdata, time_id + datum ~ town, mean, value.var="wheat")
toy <- toy[21:30,c("time_id","date","Beaufort West","Cape Town","Worcester")]
toy$t <- 1:nrow(toy)
#toy1$lnvalue <- log(toy1$value)
toy <- cbind(toy,rs_index)
toy <- dcast(comdata, time_id + datum ~ town, mean, value.var="wheat")
toy <- toy[21:30,c("time_id","datum","Beaufort West","Cape Town","Worcester")]
toy$t <- 1:nrow(toy)
#toy1$lnvalue <- log(toy1$value)
maak <- function(naam) {
toy2 <- toy
toy2 <- toy2[!is.na(toy[,naam]),c(naam,"t")]
for(i in 1:(nrow(toy2)-1)) {
toy2$P[1] <- 0
toy2$P[i+1] <- log(toy2[i+1,naam]/toy2[i,naam])
}
xmat <- array(0, dim = c(nrow(toy2)-1, nrow(toy)))
for(i in 1:(nrow(toy2)-1)) {
xmat[i,toy2$t[i]] <- -1
xmat[i,toy2$t[i+1]] <- 1
}
einde <- cbind(toy2$P[-1],xmat)
return(einde)
}
einde <- as.data.frame(rbind(maak("Beaufort West"),maak("Cape Town"),maak("Worcester")))
dy <- einde$V1
xmat <- as.matrix(einde[,2:ncol(einde)])
rsales <- lm(dy ~ xmat + 0)
rs_index <- as.data.frame(exp(rsales$coefficients))
n <- rs_index[1,1]
rs_index <- rs_index/n*100
rs_index <- na.locf(rs_index)
#rs_index2 <- exp(as.data.frame(ps.RS$coefficients))*100
toy <- cbind(toy,rs_index)
toy <- toy[,c(2,3,4,5,7)]
colnames(toy)[c(1,5)]
colnames(toy)[c(1,5)] <- c("Date","Index")
View(toy)
View(einde)
